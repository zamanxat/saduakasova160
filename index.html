<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Saduakasova 160 | Online Shoping</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="shortcut icon" href="https://i.ibb.co.com/LzswhCyD/image.png" type="image/x-icon">
    <style>
        * { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .animate-slide-up {
            animation: slideInUp 0.5s ease-out;
        }

        .animate-slide-left {
            animation: slideInLeft 0.4s ease-out;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        .animate-scale-in {
            animation: scaleIn 0.3s ease-out;
        }

        .animate-slide-right {
            animation: slideInRight 0.4s ease-out;
        }

        .product-card {
            border-radius: 24px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0, 0, 0, 0.05);
            overflow: hidden;
            height: auto;
            min-height: 320px;
            display: flex;
            flex-direction: column;
        }
        
        .product-card:active {
            transform: scale(0.96);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
        }
        
        .product-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .product-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
            transition: transform 0.4s ease-out;
        }

        .product-card:hover img {
            transform: scale(1.05);
        }
        
        .product-card-content {
            padding: 16px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 140px;
        }

        .product-card-content p {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .hit-card {
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0, 0, 0, 0.04);
            min-width: 150px;
            overflow: hidden;
            background: white;
        }
        
        .hit-card:active {
            transform: scale(0.94);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .hit-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .hit-card img {
            width: 100%;
            height: 140px;
            object-fit: cover;
            border-radius: 16px;
            margin-bottom: 10px;
            transition: transform 0.4s ease-out;
        }

        .hit-card:hover img {
            transform: scale(1.08);
        }
        
        .overlay {
            background: rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s ease-out;
        }
        
        .category-badge {
            display: block;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 6px 0;
            border-radius: 0;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin: 0;
            text-align: center;
            animation: fadeIn 0.4s ease-out;
        }

        .related-card {
            border-radius: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0, 0, 0, 0.05);
            overflow: hidden;
            background: white;
            cursor: pointer;
            height: 280px;
            display: flex;
            flex-direction: column;
        }

        .related-card:active {
            transform: scale(0.95);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .related-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }

        .related-card img {
            width: 100%;
            height: 160px;
            object-fit: cover;
            transition: transform 0.4s ease-out;
        }

        .related-card:hover img {
            transform: scale(1.06);
        }

        .related-card-content {
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .related-category-badge {
            display: block;
            background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
            color: white;
            padding: 4px 0;
            border-radius: 0;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            margin: 0;
            text-align: center;
            margin-top: auto;
        }

        .detail-modal-content {
            animation: slideInUp 0.4s ease-out;
        }

        .fab-button {
            animation: slideInUp 0.5s ease-out 0.3s both;
        }

        header {
            animation: slideInDown 0.4s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .stagger-item {
            opacity: 0;
            animation: slideInUp 0.5s ease-out forwards;
        }

        .banner-carousel {
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: #000;
        }

        .banner-slide {
            width: 100%;
            height: 220px;
            object-fit: cover;
            animation: bannerFadeIn 0.8s ease-in-out;
        }

        .banner-slide video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            animation: bannerFadeIn 0.8s ease-in-out;
        }

        @keyframes bannerFadeIn {
            from {
                opacity: 0;
                transform: scale(0.98);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes bannerSlideIn {
            from {
                opacity: 0;
                transform: translateX(30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .required-field::after {
            content: " *";
            color: #ef4444;
            font-weight: bold;
        }

        .category-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .category-grid button {
            padding: 12px;
            text-align: left;
            font-size: 13px;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans text-gray-900">

    <div id="mainContent">
        <header class="sticky top-0 bg-white/90 backdrop-blur-md shadow-md z-30 p-4">
            <input type="text" id="searchInput" placeholder="Поиск товаров..." class="w-full p-3 bg-gray-100 rounded-2xl outline-none focus:ring-2 focus:ring-blue-500 transition">
            <div id="categoryList" class="flex gap-2 mt-3 overflow-x-auto no-scrollbar py-1">
                <button onclick="filterCat('Все')" class="cat-btn px-5 py-2 bg-blue-600 text-white rounded-full whitespace-nowrap text-sm font-bold shadow-md transition-all">Все</button>
                <button onclick="filterCat('Напитки')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Напитки</button>
                <button onclick="filterCat('Сладости')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Сладости</button>
                <button onclick="filterCat('Канцелярия')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Канцелярия</button>
                <button onclick="filterCat('Выпечка')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Выпечка</button>
                <button onclick="filterCat('Печенье')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Печенье</button>
                <button onclick="filterCat('Еда')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Еда</button>
                <button onclick="filterCat('Гигиена')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Гигиена</button>
                <button onclick="filterCat('Молочные')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Молочные</button>
                <button onclick="filterCat('Закуски')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Закуски</button>
                <button onclick="filterCat('Фаст-фуд')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Фаст-фуд</button>
                <button onclick="filterCat('Фрукты')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Фрукты</button>
                <button onclick="filterCat('Другое')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Другое</button>
                <button onclick="filterCat('Услуга')" class="cat-btn px-5 py-2 bg-white border rounded-full whitespace-nowrap text-sm font-medium transition-all">Услуга</button>
            </div>
        </header>

        <main class="pb-24">
            <section class="mt-4 px-4">
                <div id="bannerCarousel" class="banner-carousel">
                    <img id="bannerSlide" class="banner-slide" src="https://avatars.mds.yandex.net/i?id=ed409b9db462783941078ea25317901aaadec7b2-1980598-images-thumbs&n=13" alt="Banner">
                </div>
                <div class="flex justify-center gap-2 mt-3">
                    <button onclick="prevBanner()" class="px-4 py-2 bg-gray-200 rounded-full text-sm font-bold hover:bg-gray-300">←</button>
                    <button onclick="nextBanner()" class="px-4 py-2 bg-gray-200 rounded-full text-sm font-bold hover:bg-gray-300">→</button>
                </div>
            </section>

            <section class="mt-6 px-4">
                <h2 class="font-black text-blue-600 text-lg uppercase tracking-wider mb-4 animate-slide-left">Хиты продаж</h2>
                <div id="hitList" class="flex gap-3 overflow-x-auto no-scrollbar pb-2"></div>
            </section>

            <section class="mt-8 px-4 mb-8">
                <h2 class="font-black text-xl mb-5 animate-slide-left">Каталог товаров</h2>
                <div id="productList" class="grid grid-cols-2 gap-4"></div>
            </section>
        </main>

        <button onclick="toggleAddModal(true)" class="fab-button fixed bottom-6 right-6 w-16 h-16 bg-blue-600 text-white rounded-full flex items-center justify-center shadow-2xl active:scale-90 transition z-40 border-4 border-white">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4" /></svg>
        </button>

        <div id="adminPanel" class="fixed inset-0 bg-white z-50 hidden p-6 overflow-y-auto">
            <div class="flex justify-between items-center mb-6 animate-slide-right">
                <h2 class="text-2xl font-black">Админ Панель</h2>
                <button onclick="toggleAdminPanel(false)" class="p-2 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>

            <div class="space-y-6">
                <!-- Админ пароль бөлімі -->
                <div class="border-t pt-6">
                    <h3 class="text-lg font-black mb-4">Админ пароль</h3>
                    <input type="text" id="newAdminPass" placeholder="Жаңа пароль" class="w-full p-3 bg-gray-50 rounded-xl border ring-1 ring-gray-200 outline-none mb-3">
                    <button onclick="updateAdminPass()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 transition-all">
                        Пароль өзгерту
                    </button>
                </div>
            </div>
        </div>

        <div id="addModal" class="fixed inset-0 bg-white z-50 hidden p-6 overflow-y-auto">
            <div class="flex justify-between items-center mb-6 animate-slide-right">
                <h2 class="text-2xl font-black">Новый товар</h2>
                <button onclick="toggleAddModal(false)" class="p-2 bg-gray-100 rounded-full text-gray-500 hover:bg-gray-200 transition-all">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label class="required-field block mb-2 font-bold text-sm">Фото товара</label>
                    <label class="flex flex-col items-center justify-center w-full h-56 border-2 border-dashed border-blue-200 rounded-[2.5rem] cursor-pointer bg-blue-50/30 hover:bg-blue-50 transition relative overflow-hidden group animate-scale-in">
                        <div id="imgPlaceholder" class="flex flex-col items-center text-blue-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            <span class="font-bold">Нажмите, чтобы добавить фото</span>
                        </div>
                        <input type="file" id="fImage" accept="image/*" class="hidden" onchange="previewImg(this)">
                        <img id="imgPreview" class="absolute inset-0 w-full h-full object-cover hidden">
                    </label>
                    <div class="error-message" id="imgError">Выберите фото товара</div>
                </div>

                <div>
                    <label class="required-field block mb-2 font-bold text-sm">Название товара</label>
                    <input type="text" id="fTitle" placeholder="Название товара" class="w-full p-4 bg-gray-50 rounded-2xl border-none ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    <div class="error-message" id="titleError">Укажите название товара</div>
                </div>

                <div>
                    <label class="required-field block mb-2 font-bold text-sm">Цена (₸)</label>
                    <input type="number" id="fPrice" placeholder="Цена (₸)" class="w-full p-4 bg-gray-50 rounded-2xl border-none ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    <div class="error-message" id="priceError">Укажите цену товара</div>
                </div>

                <div>
                    <label class="required-field block mb-2 font-bold text-sm">Категория</label>
                    <div class="category-grid">
                        <select id="fCategory" class="col-span-2 p-4 bg-gray-50 rounded-2xl border-none ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-500 outline-none appearance-none transition-all">
                            <option value="">Выберите категорию</option>
                            <option value="Напитки">Напитки</option>
                            <option value="Сладости">Сладости</option>
                            <option value="Канцелярия">Канцелярия</option>
                            <option value="Выпечка">Выпечка</option>
                            <option value="Печенье">Печенье</option>
                            <option value="Еда">Еда</option>
                            <option value="Гигиена">Гигиена</option>
                            <option value="Молочные">Молочные</option>
                            <option value="Закуски">Закуски</option>
                            <option value="Фаст-фуд">Фаст-фуд</option>
                            <option value="Фрукты">Фрукты</option>
                            <option value="Другое">Другое</option>
                            <option value="Услуга">Услуга</option>
                        </select>
                    </div>
                    <div class="error-message" id="categoryError">Выберите категорию товара</div>
                </div>

                <div>
                    <label class="required-field block mb-2 font-bold text-sm">Номер телефона</label>
                    <input type="tel" id="fPhone" placeholder="+7 (7xx) xxx-xx-xx" class="w-full p-4 bg-gray-50 rounded-2xl border-none ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    <div class="error-message" id="phoneError">Укажите номер телефона</div>
                </div>

                <div>
                    <label class="required-field block mb-2 font-bold text-sm">Номер комнаты</label>
                    <input type="tel" id="fRoom" inputmode="numeric" maxlength="3" placeholder="Номер комнаты (3 цифры)" class="w-full p-4 bg-gray-50 rounded-2xl border-none ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                    <div class="error-message" id="roomError">Номер комнаты - 3 цифры</div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="required-field block mb-2 font-bold text-sm text-xs">Код (5 цифр)</label>
                        <input type="tel" id="fOwnerCode" inputmode="numeric" placeholder="Код" class="w-full p-4 bg-gray-50 rounded-2xl text-center font-bold ring-1 ring-gray-200 outline-none transition-all">
                        <div class="error-message" id="codeError">Код - 5 цифр</div>
                    </div>
                    <div>
                        <label class="required-field block mb-2 font-bold text-sm text-xs">Админ пароль</label>
                        <input type="tel" id="fAdminCode" inputmode="numeric" placeholder="Пароль" class="w-full p-4 bg-gray-50 rounded-2xl text-center font-bold ring-1 ring-gray-200 outline-none transition-all">
                        <div class="error-message" id="adminError">Укажите пароль</div>
                    </div>
                </div>

                <button id="submitBtn" onclick="submitProduct()" class="w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black text-lg shadow-xl active:scale-95 transition-all duration-300 hover:shadow-2xl">
                    ОПУБЛИКОВАТЬ
                </button>
            </div>
        </div>

        <div id="detailModal" class="fixed inset-0 bg-white z-50 hidden flex-col overflow-y-auto">
            <div class="p-4 flex items-center justify-between border-b sticky top-0 bg-white/90 backdrop-blur-md z-10">
                <button onclick="toggleDetailModal(false)" class="text-blue-600 font-bold flex items-center gap-1 hover:scale-110 transition-transform">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg> Назад
                </button>
                <span class="font-bold text-gray-400">Товар</span>
                <div class="w-10"></div>
            </div>
            <div id="detailContent" class="detail-modal-content"></div>
        </div>

        <div id="deleteModal" class="fixed inset-0 overlay z-50 hidden flex items-end">
            <div class="w-full bg-white rounded-t-[2.5rem] p-6 animate-slide-up">
                <h3 class="text-xl font-black mb-6">Удалить объявление?</h3>
                <p class="text-gray-500 mb-6">Введите 5-значный код удаления</p>
                <input type="tel" id="deleteCode" inputmode="numeric" placeholder="Код удаления" class="w-full p-4 bg-gray-50 rounded-2xl border-none ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-500 outline-none mb-4 transition-all">
                <div class="grid grid-cols-2 gap-3">
                    <button onclick="closeDeleteModal()" class="py-4 rounded-2xl font-bold border border-gray-200 hover:bg-gray-50 transition-all">Отмена</button>
                    <button onclick="confirmDelete()" class="py-4 rounded-2xl font-bold bg-red-500 text-white hover:bg-red-600 transition-all">Удалить</button>
                </div>
            </div>
        </div>
    </div>

    <div id="updatingScreen" class="fixed inset-0 bg-white z-50 hidden flex flex-col items-center justify-center">
        <div class="text-center animate-fade-in">
            <div class="mb-6">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-20 h-20 text-blue-600 mx-auto animate-spin" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </div>
            <h1 class="text-3xl font-black text-gray-800 mb-2">Сайтта обновления</h1>
            <p class="text-gray-500 text-lg mb-8">Сайтта реконструкция жүріп жатыр</p>
            <p class="text-gray-400 text-sm">Кешірек келіңіз...</p>
        </div>
    </div>

    <script>
        const SB_URL = 'https://cgdeytbwaeuokxpjmybf.supabase.co';
        const SB_KEY = 'sb_publishable_6gTEhAHmv2YyiGBsq6i78w_YpTbxuNS';
        const client = supabase.createClient(SB_URL, SB_KEY);
        const ADMIN_PASS = "55555";

        // БАННЕРЛАР - КОД АРҚЫЛЫ ӨЗГЕРТУ

        const BANNERS = [
            { url: 'https://nesvizh.by/images/firm-news/932/banner.jpg', type: 'image' },
            { url: 'https://rostov.reklama-gravity.ru/wp-content/uploads/2023/09/1_fxVUxHlAJr2axlQHEyjjNw.jpg', type: 'image' },
            { url: 'https://avatars.mds.yandex.net/i?id=ed409b9db462783941078ea25317901aaadec7b2-1980598-images-thumbs&n=13', type: 'image' }
            // Басқа баннерлар қосыңыз:
            // { url: 'https://example.com/banner3.jpg', type: 'image' },
            // { url: 'https://example.com/video.mp4', type: 'video' }
        ];

        let allProducts = [];
        let currentBannerIdx = 0;
        let currentCat = 'Все';
        let deleteData = null;

        function previewImg(input) {
            const preview = document.getElementById('imgPreview');
            const placeholder = document.getElementById('imgPlaceholder');
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        async function loadData() {
            const { data: prods, error: prodErr } = await client.from('products').select('*').order('created_at', { ascending: false });
            if (!prodErr) allProducts = prods;
            
            render();
            updateBanner();
            startBannerAutoPlay();
        }

        let bannerAutoPlayInterval = null;

        function startBannerAutoPlay() {
            if (BANNERS.length > 1) {
                if (bannerAutoPlayInterval) clearInterval(bannerAutoPlayInterval);
                bannerAutoPlayInterval = setInterval(() => {
                    nextBanner();
                }, 10000); // 10 секунд
            }
        }

        function stopBannerAutoPlay() {
            if (bannerAutoPlayInterval) {
                clearInterval(bannerAutoPlayInterval);
                bannerAutoPlayInterval = null;
            }
        }

        function updateBanner() {
            if (BANNERS.length === 0) return;
            
            const banner = BANNERS[currentBannerIdx % BANNERS.length];
            const slide = document.getElementById('bannerSlide');
            
            if (banner.type === 'image') {
                const newImg = document.createElement('img');
                newImg.id = 'bannerSlide';
                newImg.className = 'banner-slide';
                newImg.src = banner.url;
                newImg.alt = 'Banner';
                newImg.style.animation = 'bannerFadeIn 0.8s ease-in-out';
                slide.replaceWith(newImg);
            } else if (banner.type === 'video') {
                const newVideo = document.createElement('video');
                newVideo.id = 'bannerSlide';
                newVideo.className = 'banner-slide';
                newVideo.autoplay = true;
                newVideo.muted = true;
                newVideo.loop = true;
                newVideo.style.animation = 'bannerFadeIn 0.8s ease-in-out';
                const source = document.createElement('source');
                source.src = banner.url;
                source.type = 'video/mp4';
                newVideo.appendChild(source);
                slide.replaceWith(newVideo);
            }

            updateBannerDots();
            stopBannerAutoPlay();
            startBannerAutoPlay();
        }

        function updateBannerDots() {
            const dotsContainer = document.getElementById('bannerDots');
            if (!dotsContainer || BANNERS.length === 0) return;
            
            dotsContainer.innerHTML = '';
            for (let i = 0; i < BANNERS.length; i++) {
                const dot = document.createElement('button');
                dot.className = `w-2 h-2 rounded-full transition-all duration-500 ${i === currentBannerIdx % BANNERS.length ? 'bg-blue-600 w-8' : 'bg-gray-300 hover:bg-gray-400'}`;
                dot.onclick = (e) => {
                    e.stopPropagation();
                    currentBannerIdx = i;
                    updateBanner();
                };
                dotsContainer.appendChild(dot);
            }
        }

        function nextBanner() {
            if (BANNERS.length === 0) return;
            currentBannerIdx = (currentBannerIdx + 1) % BANNERS.length;
            updateBanner();
        }

        function prevBanner() {
            if (BANNERS.length === 0) return;
            currentBannerIdx = (currentBannerIdx - 1 + BANNERS.length) % BANNERS.length;
            updateBanner();
        }

        document.getElementById('fPrice').addEventListener('input', e => {
            e.target.value = e.target.value.replace(/[^\d]/g, '');
        });

        document.getElementById('fPhone').addEventListener('input', e => {
            let x = e.target.value.replace(/\D/g, '').match(/(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);
            e.target.value = !x[2] ? x[1] : `+7 (${x[2]}) ${x[3]}${x[4] ? '-' + x[4] : ''}${x[5] ? '-' + x[5] : ''}`;
        });
        document.getElementById('fRoom').addEventListener('input', e => e.target.value = e.target.value.replace(/\D/g, '').substring(0, 3));
        document.getElementById('fOwnerCode').addEventListener('input', e => e.target.value = e.target.value.replace(/\D/g, '').substring(0, 5));
        document.getElementById('searchInput').addEventListener('input', render);

        function hideAllErrors() {
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
        }

        function showError(fieldId) {
            const el = document.getElementById(fieldId);
            if (el) el.classList.add('show');
        }

        function validateForm() {
            hideAllErrors();
            let valid = true;

            if (!document.getElementById('fImage').files[0]) {
                showError('imgError');
                valid = false;
            }
            if (!document.getElementById('fTitle').value.trim()) {
                showError('titleError');
                valid = false;
            }
            if (!document.getElementById('fPrice').value) {
                showError('priceError');
                valid = false;
            }
            if (!document.getElementById('fCategory').value) {
                showError('categoryError');
                valid = false;
            }
            if (!document.getElementById('fPhone').value || document.getElementById('fPhone').value.replace(/\D/g, '').length < 11) {
                showError('phoneError');
                valid = false;
            }
            if (document.getElementById('fRoom').value.length !== 3) {
                showError('roomError');
                valid = false;
            }
            if (document.getElementById('fOwnerCode').value.length !== 5) {
                showError('codeError');
                valid = false;
            }
            if (!document.getElementById('fAdminCode').value) {
                showError('adminError');
                valid = false;
            }

            return valid;
        }

        function toggleAddModal(s) {
            document.getElementById('addModal').classList.toggle('hidden', !s);
            if(!s) resetForm();
        }
        function toggleDetailModal(s) { document.getElementById('detailModal').classList.toggle('hidden', !s); }

        function resetForm() {
            document.getElementById('fTitle').value = "";
            document.getElementById('fPrice').value = "";
            document.getElementById('fCategory').value = "";
            document.getElementById('fPhone').value = "";
            document.getElementById('fRoom').value = "";
            document.getElementById('fOwnerCode').value = "";
            document.getElementById('fAdminCode').value = "";
            document.getElementById('fImage').value = "";
            document.getElementById('imgPreview').src = "";
            document.getElementById('imgPreview').classList.add('hidden');
            document.getElementById('imgPlaceholder').classList.remove('hidden');
            hideAllErrors();

            const btn = document.getElementById('submitBtn');
            btn.className = "w-full bg-blue-600 text-white py-5 rounded-[2rem] font-black text-lg shadow-xl active:scale-95 transition-all duration-300 hover:shadow-2xl";
            btn.innerText = "ОПУБЛИКОВАТЬ";
            btn.disabled = false;
        }

        function filterCat(cat) {
            currentCat = cat;
            document.querySelectorAll('.cat-btn').forEach(b => {
                const active = b.innerText === cat;
                b.className = `cat-btn px-5 py-2 rounded-full whitespace-nowrap text-sm font-bold transition-all ${active ? 'bg-blue-600 text-white shadow-lg scale-105' : 'bg-white border text-gray-500 hover:border-blue-300'}`;
            });
            render();
        }

        async function submitProduct() {
            if (!validateForm()) return;

            const btn = document.getElementById('submitBtn');
            const adminInput = document.getElementById('fAdminCode').value;
            const imgFile = document.getElementById('fImage').files[0];

            if (adminInput !== ADMIN_PASS) return showErrorModal("Неверный админ пароль!");

            showUpdatingScreen();

            try {
                const fileName = `${Date.now()}_${imgFile.name}`;
                const { error: imgErr } = await client.storage.from('product photo').upload(fileName, imgFile);
                if (imgErr) throw imgErr;

                const { data: publicUrl } = client.storage.from('product photo').getPublicUrl(fileName);

                const { error: dbErr } = await client.from('products').insert([{
                    title: document.getElementById('fTitle').value,
                    price: parseInt(document.getElementById('fPrice').value),
                    category: document.getElementById('fCategory').value,
                    phone: document.getElementById('fPhone').value,
                    room_number: document.getElementById('fRoom').value,
                    owner_code: document.getElementById('fOwnerCode').value,
                    image_url: publicUrl.publicUrl,
                    is_hit: false
                }]);
                if (dbErr) throw dbErr;

                setTimeout(() => {
                    hideUpdatingScreen();
                    toggleAddModal(false);
                    loadData();
                }, 2000);

            } catch (err) {
                hideUpdatingScreen();
                showErrorModal("Ошибка: " + err.message);
            }
        }

        function showErrorModal(msg) {
            const modal = document.createElement('div');
            modal.className = "fixed inset-0 overlay z-50 flex items-end";
            modal.innerHTML = `
                <div class="w-full bg-white rounded-t-[2.5rem] p-6 animate-slide-up">
                    <p class="text-center font-bold text-gray-800 mb-4">${msg}</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold hover:bg-blue-700 transition-all">Понял</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function getRandomRelated(allProds, currentProd, limit = 6) {
            // Бірінші, бір категорияның товарларын табу
            let similar = allProds.filter(p => p.id !== currentProd.id && p.category === currentProd.category);
            
            // Егер категорияда басқа товар болмаса, барлық товардан таңдау
            if (similar.length === 0) {
                similar = allProds.filter(p => p.id !== currentProd.id);
            } else if (similar.length < limit) {
                // Егер категорияда 6-дан аз болса, басқа категориялардан қосу
                const otherProducts = allProds.filter(p => 
                    p.id !== currentProd.id && 
                    p.category !== currentProd.category &&
                    !similar.find(s => s.id === p.id)
                );
                similar = similar.concat(otherProducts.slice(0, limit - similar.length));
            }
            
            // Аралау
            for (let i = similar.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [similar[i], similar[j]] = [similar[j], similar[i]];
            }
            
            return similar.slice(0, limit);
        }

        function openDetail(p) {
            const relatedProducts = getRandomRelated(allProducts, p, 6);
            
            document.getElementById('detailContent').innerHTML = `
                <div class="relative overflow-hidden">
                    <img src="${p.image_url}" class="w-full h-[500px] object-cover shadow-lg animate-fade-in">
                </div>
                <div class="p-6 animate-slide-up">
                    <h1 class="text-2xl font-black text-gray-800 leading-tight mb-3">${p.title}</h1>
                    <span class="text-3xl font-black text-blue-600">${p.price} ₸</span>

                    <div class="mt-6 space-y-2">
                        <div class="flex items-center justify-between p-3 bg-gradient-to-r from-blue-50 to-transparent rounded-xl border border-blue-100">
                            <span class="text-sm text-gray-500 font-medium">Номер комнаты</span>
                            <span class="font-bold text-gray-800 bg-white px-3 py-1 rounded-lg shadow-sm text-base">${p.room_number}</span>
                        </div>
                    </div>

                    <a href="tel:${p.phone}" class="mt-6 w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-4 rounded-[2rem] flex items-center justify-center gap-2 font-black text-lg shadow-xl shadow-blue-300 active:scale-95 hover:shadow-2xl transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>
                        Позвонить
                    </a>

                    <button onclick="openDeleteModal('${p.id}', '${p.owner_code}')" class="mt-3 w-full text-red-500 font-bold text-xs uppercase tracking-wide opacity-70 hover:opacity-100 transition-opacity">Удалить объявление</button>

                    <div class="mt-10 mb-8" id="relatedSection">
                        <h3 class="font-black text-base mb-3 text-gray-800">Похожие товары</h3>
                        <div class="grid grid-cols-2 gap-4" id="relBox"></div>
                    </div>
                </div>
            `;
            const relBox = document.getElementById('relBox');
            
            if (relatedProducts.length > 0) {
                relatedProducts.forEach((r, index) => {
                    const d = document.createElement('div');
                    d.className = "related-card stagger-item";
                    d.style.animationDelay = `${0.08 * index}s`;
                    d.onclick = () => { openDetail(r); document.getElementById('detailModal').scrollTop = 0; };
                    d.innerHTML = `
                        <img src="${r.image_url}" class="animate-fade-in">
                        <div class="related-card-content">
                            <p class="text-xs font-bold text-gray-800 mb-auto line-clamp-2">${r.title}</p>
                            <p class="text-sm font-black text-blue-600 mb-2">${r.price} ₸</p>
                            <div class="related-category-badge">${r.category}</div>
                        </div>
                    `;
                    relBox.appendChild(d);
                });
            }
            toggleDetailModal(true);
        }

        function openDeleteModal(id, code) {
            deleteData = { id, code };
            document.getElementById('deleteCode').value = "";
            document.getElementById('deleteModal').classList.remove('hidden');
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.add('hidden');
            deleteData = null;
        }

        async function confirmDelete() {
            if (!deleteData) return;
            const input = document.getElementById('deleteCode').value;
            if (input === deleteData.code) {
                await client.from('products').delete().eq('id', deleteData.id);
                closeDeleteModal();
                toggleDetailModal(false);
                loadData();
            } else if(input) {
                showErrorModal("Неверный код!");
            }
        }

        function render() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const hitBox = document.getElementById('hitList');
            const proBox = document.getElementById('productList');
            hitBox.innerHTML = ""; 
            proBox.innerHTML = "";

            // ХИТЫ ПРОДАЖ - is_hit true болғандарын тапу
            let hitProducts = allProducts.filter(p => p.is_hit === true);
            
            // Егер хит өнім болмаса, ең соңғы 10 өнімді қосу
            if (hitProducts.length === 0) {
                hitProducts = allProducts.slice(0, 10);
            } else {
                hitProducts = hitProducts.slice(0, 10);
            }

            hitProducts.forEach((p, index) => {
                const d = document.createElement('div');
                d.className = "hit-card p-3 cursor-pointer stagger-item";
                d.style.animationDelay = `${0.08 * index}s`;
                d.onclick = () => openDetail(p);
                d.innerHTML = `
                    <img src="${p.image_url}">
                    <div class="px-1">
                        <p class="text-[10px] font-bold text-blue-500 uppercase tracking-tighter truncate">${p.category}</p>
                        <p class="text-xs font-bold text-gray-800 truncate leading-tight mb-1">${p.title}</p>
                        <p class="text-blue-600 text-sm font-black">${p.price} ₸</p>
                    </div>
                `;
                hitBox.appendChild(d);
            });

            const filteredProducts = allProducts.filter(p => (currentCat === 'Все' || p.category === currentCat) && p.title.toLowerCase().includes(search));
            
            if (filteredProducts.length === 0) {
                proBox.innerHTML = `
                    <div class="col-span-2 flex flex-col items-center justify-center py-16 animate-fade-in">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                        </svg>
                        <p class="text-gray-400 text-lg font-bold text-center">Товары в категории <span class="text-blue-600">"${currentCat}"</span> не найдены</p>
                        <p class="text-gray-300 text-sm mt-2">Попробуйте выбрать другую категорию</p>
                    </div>
                `;
            } else {
                filteredProducts.forEach((p, index) => {
                    const d = document.createElement('div');
                    d.className = "product-card cursor-pointer stagger-item";
                    d.style.animationDelay = `${0.1 * index}s`;
                    d.onclick = () => openDetail(p);
                    d.innerHTML = `
                        <img src="${p.image_url}">
                        <div class="product-card-content">
                            <div>
                                <p class="text-sm font-bold text-gray-800">${p.title}</p>
                                <p class="text-lg font-black text-blue-600 mt-2">${p.price} ₸</p>
                            </div>
                            <div class="category-badge" style="margin: 8px -16px -16px -16px;">${p.category}</div>
                        </div>
                    `;
                    proBox.appendChild(d);
                });
            }
        }

        function showUpdatingScreen() {
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('updatingScreen').classList.remove('hidden');
        }

        function hideUpdatingScreen() {
            document.getElementById('updatingScreen').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        // Мысалы: 5 секунд ішінде обновления аяқталсын

        // showUpdatingScreen();
        // setTimeout(() => {
        //     hideUpdatingScreen();
        // }, 10000000);

        loadData();

    </script>
</body>
</html>
